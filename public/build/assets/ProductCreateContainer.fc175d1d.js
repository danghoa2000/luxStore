import{a7 as H,R as t,T as M,aa as U,B as G,i as Q,S as W,c as X,r,au as Z,av as c,aG as V,u as ee,d as x,aF as te,q as y,ae,ad as re,aC as se,a9 as oe,aw as ie}from"./index.5ce80200.js";import{B as ce,P as ne,a as ue,b as de,c as le}from"./ProductSetting.33e58a8f.js";import"./ProductAvatar.1b82f846.js";import{B as me}from"./Breadcrumbs.f5b119d2.js";import"./lodash.04c458ec.js";import{f as D}from"./index.d7c082dd.js";import"./Select.fa04d544.js";import"./OutlinedInput.63c5b1ce.js";import"./CalendarMonth.a98bc8b4.js";import"./BorderColor.6ee4679d.js";import"./TextField.f7bb6de6.js";import"./ListSubheader.7cd47645.js";import"./Chip.9e8533e0.js";import"./AddCircleSharp.04bafc2d.js";import"./RadioGroup.7a04bd2c.js";import"./index.834d2615.js";const pe=f=>{const{redirectBack:P,handleCreate:T,handleSubmit:R,control:n,reset:s,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l,loading:E,showNoti:q,setStatus:b,status:S,setShowNoti:C,groupCategorytList:p,categoryList:I,manufacturerList:A,avatarRef:v,imageRef:h,productPropertyRef:g,getGroupCategory:L,product:m,groupCategoryId:w,setGroupCategoryId:_}=f;return H(),t.createElement(t.Fragment,null,t.createElement("div",{className:"d-flex justify-content-between align-items-center"},t.createElement(M,{variant:"h4",gutterBottom:!0},"Product"),t.createElement(me,{separator:"\u203A","aria-label":"breadcrumb"},t.createElement(U,{to:"/admin"},"Home"),t.createElement(U,{to:"/admin/categories"},"Product"),t.createElement(M,null,"Create"))),t.createElement("div",{style:{marginBottom:10}},t.createElement(G,{variant:"contained",onClick:()=>P()},"Back")),t.createElement("form",{onSubmit:R(T)},t.createElement(ce,{control:n,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l,avatarRef:v}),t.createElement(ne,{control:n,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l,groupCategorytList:p,categoryList:I,manufacturerList:A,groupCategoryId:w,setGroupCategoryId:_,onChangeGroupCategory:()=>{g.current.removeAll()}}),t.createElement(ue,{control:n,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l,imageRef:h,initValue:m&&(m==null?void 0:m.product_media.map(k=>k.url))}),t.createElement(de,{control:n,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l,setStatus:b,setShowNoti:C,ref:g,name:"property",groupCategorytList:p,getGroupCategory:L}),t.createElement(le,{control:n,setValue:u,getValues:o,setError:d,clearErrors:i,errors:l}),t.createElement("div",{className:"d-flex justify-content-center w-100"},t.createElement(G,{variant:"contained",type:"submit",className:"m-1",disabled:E},E&&t.createElement(Q,{disableShrink:!0,style:{color:"white",width:"14px",height:"14px",margin:"0 5px 0 0"}}),"Create"),t.createElement(G,{variant:"contained",type:"reset",className:"m-1 btn-cancel",onClick:()=>{h.current.removeAll(),v.current.removeAll(),g.current.removeAll(),s(),_(-1)}},"Clear"))),q&&t.createElement(W,{type:S.type,message:S.message,setShowNoti:C}))};const Ae=()=>{const f=X(),[P,T]=r.exports.useState(!1),[R,n]=r.exports.useState(!1),[s]=H(),[u,o]=r.exports.useState({}),[d,i]=r.exports.useState(!1),[l,E]=r.exports.useState([]),[q,b]=r.exports.useState([]),[S,C]=r.exports.useState([]),[p,I]=r.exports.useState(-1),A=r.exports.useRef(),v=r.exports.useRef(),h=r.exports.useRef(),g=r.exports.useRef(),L=()=>f(-1),m=Z().shape({product_code:c().required(s("validate.required",{name:"Product code"})),name:c().required(s("validate.required",{name:"Product name"})),group_category_id:c().required(s("validate.required",{name:"Group category"})).test("isSelect",s("validate.required",{name:"Group category"}),e=>e!="-1"),category_id:c().required(s("validate.required",{name:"Category"})).test("isSelect",s("validate.required",{name:"Category"}),e=>e!="-1"),manufacturer_id:c().required(s("validate.required",{name:"Manufacturer"})).test("isSelect",s("validate.required",{name:"Manufacturer"}),e=>e!="-1"),price_saled:c().when(["sale_type","expried"],{is:(e,a)=>{if(e&&e!=-1||a)return!0},then:()=>c().required(s("validate.required",{name:"Price saled"})).test("","Invalid value",(e,a)=>{if(a.parent.sale_type==V.PRICE)return e;if(a.parent.sale_type==V.PERSEN)return 0<=e<=100})}),sale_type:c().when(["expried","price_saled"],{is:(e,a)=>{if(e||a)return!0},then:()=>c().required(s("validate.required",{name:"Sale type"})).test("isSelect",s("validate.required",{name:"Sale type"}),e=>e!="-1")}),expried:c().when(["sale_type","price_saled"],{is:(e,a)=>{if(e&&e!=-1||a)return!0},then:()=>c().required(s("validate.required",{name:"Expried sale"})).test("","Invalid value",e=>(console.log(e,D(new Date,"yyyy-MM-dd")),e>D(new Date,"yyyy-MM-dd")))})},[["sale_type","expried"],["expried","price_saled"],["sale_type","price_saled"]]),{handleSubmit:w,control:_,reset:k,setValue:j,getValues:F,setError:N,clearErrors:K,formState:{errors:Y}}=ee({shouldUnregister:!1,defaultValues:{avatar:[],file:[],product_code:"",name:"",price:"",status:oe.ACTIVE,group_category_id:p,category_id:-1,manufacturer_id:-1,description:"",price_saled:"",sale_type:-1,expried:""},resolver:ie(m)}),$=r.exports.useCallback(e=>{n(!0),x.post(te.CREATE,{...e}).then(a=>{i(!0),n(!1),a.data.code===y.HTTP_OK&&(o({type:"success",message:a.data.message}),setTimeout(()=>{f(-1)},1500))}).catch(({response:a})=>{i(!0),n(!1),a.data.code===y.UNPROCESSABLE_ENTITY&&Object.keys(a.data.errors).forEach(O=>{N(O,{type:"custom",message:Object.values(a.data.errors[O])})}),o({type:"error",message:a.data?a.data.message:"Server error"})})}),B=r.exports.useCallback(()=>{x.get(ae.LIST).then(e=>{e.data.code===y.HTTP_OK&&E(e.data.groupCategories)}).catch(e=>{o({type:"error",message:e.data?e.data.message:"Server error"}),i(!0)})},[]),z=r.exports.useCallback(()=>{x.get(re.LIST).then(e=>{e.data.code===y.HTTP_OK&&b(e.data.categories)}).catch(e=>{o({type:"error",message:e.data?e.data.message:"Server error"}),i(!0)})},[]),J=r.exports.useCallback(()=>{x.get(se.LIST).then(e=>{e.data.code===y.HTTP_OK&&C(e.data.manufacturers)}).catch(e=>{o({type:"error",message:e.data?e.data.message:"Server error"}),i(!0)})},[]);return r.exports.useEffect(()=>{B(),z(),J()},[]),t.createElement(pe,{redirectBack:L,handleCreate:$,toggleDirection:P,setToggleDirection:T,handleSubmit:w,control:_,reset:k,setValue:j,getValues:F,setError:N,clearErrors:K,errors:Y,loading:R,showNoti:d,status:u,setStatus:o,setShowNoti:i,groupCategorytList:l,categoryList:q,manufacturerList:S,avatarRef:A,imageRef:v,categoryGroupRef:g,productPropertyRef:h,getGroupCategory:B,groupCategoryId:p,setGroupCategoryId:I})};export{Ae as default};
